<!DOCTYPE html>
<html lang="en">
 
<!-- Copyright 2016 J.D. Sandifer
     Full license for this project is found in the "LICENSE" file located in 
     the same directory as this file. -->

<head>
    <meta charset="utf-8">
    <title>Speaker Timer</title>

    <style type="text/css">
      body {
        background: #000;
        color: #ccc;
        font-size: 300px;
        font-family: helvetica, arial, sans-serif;
        text-align: center;
      }

      h1 {
        -webkit-margin-before: 0em;
        -webkit-margin-after: 0em;
      }

      button {
        border-radius: 12px;
        font-size: 0.125em;
        float: left;
      }
    </style>

    <script type="text/javascript">

      function startTimer() {
        var initialTimeString;
        var minutes;
        var seconds;
        var timeString;
        
        var darkGreenColor = "#009900";
        changeBackgroundColor(darkGreenColor);

        document.getElementById("startButton").innerHTML = "Restart";
        document.getElementById("startButton").onclick = 
          function(){
            window.location.reload(false);
          };

        initialTimeString = getTimerElement().innerHTML;

        minutes = extractMinutesNum(initialTimeString);
        seconds = extractSecondsNum(initialTimeString);
      
        setTimeout(
          function(){
            countDown(minutes, seconds);
          },
          1000);
      }
      
      function changeBackgroundColor(color) {
          document.body.style.backgroundColor = color;
      }

      function getTimerElement() {
        return document.getElementById("timeDisplay");
      }

      function extractMinutesNum(timeString) {
        return 1 * timeString.substring(0,2);
      }

      function extractSecondsNum(timeString) {
        return 1 * timeString.substring(3,5);
      }

      function countDown(minutes, seconds) {
        var timeString;

        minutes = subtractOneMinuteIfTime(minutes, seconds);
        seconds = subtractOneSecond(seconds);

        timeString = timeToString(minutes, seconds);

        updateTimeDisplay(timeString);

        if (minutes != 0 || seconds != 0) {
          setTimeout(
            function(){
              countDown(minutes, seconds);
            },
            1000);
        }
      }

      function subtractOneMinuteIfTime(minutes, seconds) {
        return (seconds === 0) ? minutes - 1: minutes;
      }

      function subtractOneSecond(seconds) {
        return (seconds === 0) ? 59:seconds - 1;
      }

      /*
       * Expects minutes and seconds to be 1 or 2 digit natural numbers.
       */
      function timeToString(minutes, seconds) {
        var minString;
        var secString;
        
        minString = timePartToString(minutes);
        secString = timePartToString(seconds);

        return minString + ':' + secString;
      }

      /*
       * Expects 1 or 2 digit natural number for timePartNum.
       */
      function timePartToString(timePartNum) {
  	if (timePartNum <= 9) {
          return '0' + timePartNum;
        } else {
          return timePartNum.toString();
        }
      }

      function updateTimeDisplay(timeString) {
	getTimerElement().innerHTML = timeString;
      }

    </script>
  </head>
  <body>

    <!-- Change the time below to set the timer and then reload
         the web page. Make sure to use MM:SS format. -->

    <h1 id="timeDisplay">01:00</h1>

    <form>
      <button id="startButton" type="button" value="start" onClick="startTimer()">
        Start
      </button>
    </form>
  </body>
</html>